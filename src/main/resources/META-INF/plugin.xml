<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
    <id>com.github.lihang15.intellijpluginsforandroidstudio</id>
    <name>Intellij-Plugins-For-AndroidStudio</name>
    <vendor>lihang15</vendor>

    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.java</depends>

    <resource-bundle>messages.MyBundle</resource-bundle>

    <depends>org.jetbrains.android</depends>
    <depends>com.intellij.modules.androidstudio</depends>
    
          <!-- 测试java/kotlin代码是否正常 -->
    <actions>
        <action
                id="Lldb_DemoAction"
                class="org.jetbrains.plugins.template.debuger.StartLldbAction"
                text="test kotlin Start LLDB Demo"
                description="Start lldb-_ and send initialize">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>
        <action
                id="javaAction"
                class="com.eazytec.plugins.TestAction"
                text="test Java Action"
                description="Start lldb-_ and send initialize">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>
    </actions>
    
    <!-- HarmonyOS Device Selector in Toolbar (自定义设备选择器) -->
    <actions>
        <!-- HarmonyOS Device Selector Group - 新 UI (2022.3+) -->
        <group id="HarmonyOS.MainToolbarActions">
            <action id="HarmonyOS.DeviceSelector"
                    class="org.jetbrains.plugins.template.device.FlutterStyleDeviceSelectorAction"
                    description="HarmonyOS Device Selection"
                    text="HarmonyOS Device"/>
            <add-to-group anchor="before" group-id="RunToolbarMainActionGroup" relative-to-action="RedesignedRunConfigurationSelector"/>
        </group>
        
        <!-- HarmonyOS Device Selector Group - 旧 UI (兼容性) -->
        <group id="HarmonyOS.MainToolbarActionsLegacy">
            <action id="HarmonyOS.DeviceSelectorLegacy"
                    class="org.jetbrains.plugins.template.device.FlutterStyleDeviceSelectorAction"
                    description="HarmonyOS Device Selection"
                    text="HarmonyOS Device"/>
            <add-to-group anchor="before" group-id="ToolbarRunGroup" relative-to-action="RunConfiguration"/>
        </group>
    </actions>

    <extensions defaultExtensionNs="com.intellij">
     <!-- Project Startup -->
        <postStartupActivity implementation="org.jetbrains.plugins.template.projectsync.MyProjectActivity" />
        
        <!-- Tim LSP Startup Activity (ProjectActivity API) -->
        <postStartupActivity implementation="lsp.tim.TimStartupActivity" />
        
         <!-- 注册项目级数据服务,项目打开后，sync一些数据，供插件代码全局使用 -->
            <projectService 
        serviceImplementation="org.jetbrains.plugins.template.projectsync.DataSyncService"/>
        
        <!-- OHOS 路径服务：存储 local.properties 中的 local.ohos.path -->
        <projectService
            serviceImplementation="org.jetbrains.plugins.template.projectsync.localproperties.OhosPathService"/>
        
        <!-- HarmonyOS Device Service -->
        <projectService serviceImplementation="org.jetbrains.plugins.template.device.DeviceService"/>
        
        <!-- 注释掉 HarmonyOS Execution Target Provider - 不再使用 ExecutionTarget 系统 -->
        <!-- <executionTargetProvider implementation="org.jetbrains.plugins.template.device.HarmonyExecutionTargetProvider"/> -->
        
          <!-- MyMainCpp 运行配置 -->
        <configurationType implementation="org.jetbrains.plugins.template.cpp.MyMainCppConfigurationType"/>
        <runConfigurationProducer implementation="org.jetbrains.plugins.template.cpp.MyMainCppRunConfigurationProducer"/>
        <programRunner implementation="org.jetbrains.plugins.template.cpp.MyMainCppDebugRunner"/>
        
        <!-- LLDB 断点类型 -->
        <xdebugger.breakpointType implementation="org.jetbrains.plugins.template.debuger.LLDBLineBreakpointType"/>
        
    </extensions>


  <!-- 创建 项目模版 -->
    <extensions defaultExtensionNs="com.android.tools.idea.wizard.template">
<!--        <wizardTemplateProvider-->
<!--                implementation="wizard.KMPWizardTemplateProvider"/>-->

<!--                 &lt;!&ndash; KMP-OHOS 项目生成器 (IntelliJ Platform API) &ndash;&gt;-->
<!--        <directoryProjectGenerator implementation="wizard.KmpOhosProjectGenerator"/>-->

        <wizardTemplateProvider
                implementation="wizard.projectwizard.AndroidStudioTemplateProvider"/>
    </extensions>




    <!-- LSP4IntelliJ Extensions for Tim Language -->
    <extensions defaultExtensionNs="com.intellij">
        <!-- Tim Language and File Type Registration -->
        <fileType
                name="Tim File"
                language="Tim"
                implementationClass="lsp.tim.TimFileType"
                extensions="tim"/>
        <language
                id="Tim"
                implementationClass="lsp.tim.TimLanguage"/>

        <!-- Tim Parser Definition - Required for PSI and ExternalAnnotator -->
        <lang.parserDefinition
                language="Tim"
                implementationClass="lsp.tim.psi.TimParserDefinition"/>

        <!-- Tim Syntax Highlighter - For basic syntax highlighting -->
        <lang.syntaxHighlighterFactory
                language="Tim"
                implementationClass="lsp.tim.TimSyntaxHighlighterFactory"/>

          <!-- Tim Diagnostic Monitor - For debugging LSP diagnostics -->
        <externalAnnotator id="TimDiagnosticMonitor"
                           language="Tim"
                           implementationClass="lsp.tim.TimDiagnosticMonitor"
                           order="last"/>

        <!-- LSP4IntelliJ Core Services -->
        <applicationService serviceImplementation="org.wso2.lsp4intellij.IntellijLanguageClient"/>

        <!-- LSP Editor and File Sync Listeners -->
        <editorFactoryListener implementation="org.wso2.lsp4intellij.listeners.LSPEditorListener"/>
        <fileDocumentManagerListener implementation="org.wso2.lsp4intellij.listeners.LSPFileDocumentManagerListener"/>

        <!-- LSP Notification Groups -->
        <notificationGroup id="lsp" displayType="STICKY_BALLOON"/>
        <notificationGroup id="LSPProgressNotification" displayType="NONE" />
        
        <!-- HarmonyOS Device Notification Group -->
        <notificationGroup id="HarmonyOS Device" displayType="BALLOON"/>
        
        <!-- Project Wizard Notification Group -->
        <notificationGroup id="QuickProjectWizard" displayType="BALLOON"/>

        <!-- LSP Status Bar Widget -->
        <statusBarWidgetFactory implementation="org.wso2.lsp4intellij.statusbar.LSPServerStatusWidgetFactory"
                                id="org.wso2.lsp4intellij.statusbar.LSPServerStatusWidgetFactory"
                                order="first" />

        <!-- LSP Code Completion -->
        <completion.contributor implementationClass="org.wso2.lsp4intellij.contributors.LSPCompletionContributor"
                                id="org.wso2.lsp4intellij.contributors.LSPCompletionContributor" 
                                language="Tim"/>
        <typedHandler implementation="org.wso2.lsp4intellij.listeners.LSPTypedHandler"
                      id="LSPTypedHandler"/>

        <!-- LSP Code Diagnostics (Annotations) -->
        <externalAnnotator id="LSPAnnotator" 
                           language="Tim"
                           implementationClass="org.wso2.lsp4intellij.contributors.annotator.LSPAnnotator"/>

      

        <!-- LSP Workspace Symbols -->
        <gotoSymbolContributor implementation="org.wso2.lsp4intellij.contributors.symbol.LSPSymbolContributor"
                               id="LSPSymbolContributor"/>

        <!-- LSP Rename Support -->
        <renameHandler implementation="org.wso2.lsp4intellij.contributors.rename.LSPRenameHandler" 
                       id="LSPRenameHandler" 
                       order="first"/>
        <renamePsiElementProcessor implementation="org.wso2.lsp4intellij.contributors.rename.LSPRenameProcessor" 
                                   id="LSPRenameProcessor" 
                                   order="first"/>

        <!-- LSP Folding Support -->
        <lang.foldingBuilder language="Tim" 
                             implementationClass="org.wso2.lsp4intellij.contributors.LSPFoldingRangeProvider" 
                             id="LSPFoldingRangeProvider" 
                             order="first" />

        <!-- LSP Go to Definition Support -->
        <gotoDeclarationHandler implementation="org.wso2.lsp4intellij.contributors.goto.LSPGotoDeclarationHandler"
                                id="LSPGotoDeclarationHandler"
                                order="first"/>
    </extensions>

    <!-- LSP Actions -->
    <actions>
        <!-- LSP Hover/Quick Doc -->
        <action id="org.intellij.sdk.action.QuickDocAction" 
                class="org.wso2.lsp4intellij.actions.LSPQuickDocAction">
        </action>

        <!-- LSP Find References -->
        <action class="org.wso2.lsp4intellij.actions.LSPReferencesAction" 
                id="LSPFindUsages">
            <keyboard-shortcut first-keystroke="shift alt F7" keymap="$default"/>
        </action>
    </actions>

    <!-- LSP Application Listeners -->
    <applicationListeners>
        <!-- VFS Sync for LSP -->
        <listener class="org.wso2.lsp4intellij.listeners.VFSListener"
                  topic="com.intellij.openapi.vfs.VirtualFileListener"/>
        <!-- Project Manager Listener for LSP -->
        <listener class="org.wso2.lsp4intellij.listeners.LSPProjectManagerListener"
                  topic="com.intellij.openapi.project.ProjectManagerListener"/>
    </applicationListeners>
    
    <!-- Project Listeners -->
    <projectListeners>
        <!-- Run Configuration Listener for HarmonyOS Device Selection -->
        <listener class="org.jetbrains.plugins.template.device.RunConfigurationListener"
                  topic="com.intellij.execution.RunManagerListener"/>
        
        <!-- OHOS PostSync Listener: 监听 Gradle Sync 完成事件 -->
        <listener class="org.jetbrains.plugins.template.projectsync.localproperties.OhosPostSyncExtension"
                  topic="com.android.tools.idea.gradle.project.sync.GradleSyncListenerWithRoot"/>
    </projectListeners>
    
    <!-- Application Listeners -->
    <applicationListeners>
        <!-- Global Run Configuration Listener -->
        <listener class="org.jetbrains.plugins.template.device.GlobalRunConfigurationListener"
                  topic="com.intellij.execution.RunManagerListener"/>
    </applicationListeners>

</idea-plugin>
