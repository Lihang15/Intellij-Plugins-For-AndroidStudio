<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
    <id>com.github.lihang15.intellijpluginsforandroidstudio</id>
    <name>KMP-Harmony-For-AndroidStudio</name>
    <vendor>lihang15</vendor>

    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.java</depends>

    <resource-bundle>messages.MyBundle</resource-bundle>

    <depends>org.jetbrains.android</depends>
    <depends>com.intellij.modules.androidstudio</depends>
    
          <!-- 测试java/kotlin代码是否正常 -->
    <actions>
        <action
                id="Lldb_DemoAction"
                class="org.jetbrains.plugins.template.debuger.StartLldbAction"
                text="test kotlin Start LLDB Demo"
                description="Start lldb-_ and send initialize">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>
        
 
    </actions>
    
    <!-- HarmonyOS Device Selector in Toolbar (自定义设备选择器) -->
    <actions>
        <!-- HarmonyOS Device Selector Group - 新 UI (2022.3+) -->
        <group id="HarmonyOS.MainToolbarActions">
            <action id="HarmonyOS.DeviceSelector"
                    class="org.jetbrains.plugins.template.device.DeviceSelectorAction"
                    description="HarmonyOS Device Selection"
                    text="HarmonyOS Device"/>
            <add-to-group anchor="before" group-id="RunToolbarMainActionGroup" relative-to-action="RedesignedRunConfigurationSelector"/>
        </group>
        
        <!-- HarmonyOS Device Selector Group - 旧 UI (兼容性) -->
        <group id="HarmonyOS.MainToolbarActionsLegacy">
            <action id="HarmonyOS.DeviceSelectorLegacy"
                    class="org.jetbrains.plugins.template.device.DeviceSelectorAction"
                    description="HarmonyOS Device Selection"
                    text="HarmonyOS Device"/>
            <add-to-group anchor="before" group-id="ToolbarRunGroup" relative-to-action="RunConfiguration"/>
        </group>
    </actions>

    <extensions defaultExtensionNs="com.intellij">
     <!-- Project Startup -->
        <postStartupActivity implementation="org.jetbrains.plugins.template.projectsync.MyProjectActivity" />
        
        
         <!-- 注册项目级数据服务,项目打开后，sync一些数据，供插件代码全局使用 -->
            <projectService 
        serviceImplementation="org.jetbrains.plugins.template.projectsync.DataSyncService"/>
        
        <!-- OHOS 路径服务：存储 local.properties 中的 local.ohos.path -->
        <projectService
            serviceImplementation="org.jetbrains.plugins.template.projectsync.localproperties.OhosPathService"/>
        
        <!-- HarmonyOS Device Service -->
        <projectService serviceImplementation="org.jetbrains.plugins.template.device.DeviceService"/>
        
        <!-- 注释掉 HarmonyOS Execution Target Provider - 不再使用 ExecutionTarget 系统 -->
        <!-- <executionTargetProvider implementation="org.jetbrains.plugins.template.device.HarmonyExecutionTargetProvider"/> -->
        
          <!-- Harmony 运行配置 -->
        <configurationType implementation="org.jetbrains.plugins.template.runconfig.HarmonyConfigurationType"/>
        <runConfigurationProducer implementation="org.jetbrains.plugins.template.runconfig.HarmonyRunConfigurationProducer"/>
        <programRunner implementation="org.jetbrains.plugins.template.runconfig.HarmonyDebugRunner"/>
        
        <!-- LLDB 断点类型 -->
        <xdebugger.breakpointType implementation="org.jetbrains.plugins.template.debuger.LLDBLineBreakpointType"/>
        
        <!-- Notification Groups -->
        <notificationGroup id="QuickProjectWizard" displayType="BALLOON" isLogByDefault="true"/>
        <notificationGroup id="HarmonyOS Device" displayType="BALLOON" isLogByDefault="true"/>
        
    </extensions>


  <!-- 创建 项目模版 -->
    <extensions defaultExtensionNs="com.android.tools.idea.wizard.template">
<!--        <wizardTemplateProvider-->
<!--                implementation="wizard.KMPWizardTemplateProvider"/>-->

<!--                 &lt;!&ndash; KMP-OHOS 项目生成器 (IntelliJ Platform API) &ndash;&gt;-->
<!--        <directoryProjectGenerator implementation="wizard.KmpOhosProjectGenerator"/>-->

        <wizardTemplateProvider
                implementation="wizard.projectwizard.AndroidStudioTemplateProvider"/>
    </extensions>



    
    <!-- Project Listeners -->
    <projectListeners>
        <!-- Run Configuration Listener for HarmonyOS Device Selection -->
        <listener class="org.jetbrains.plugins.template.device.RunConfigurationListener"
                  topic="com.intellij.execution.RunManagerListener"/>
        
        <!-- OHOS PostSync Listener: 监听 Gradle Sync 完成事件 -->
        <listener class="org.jetbrains.plugins.template.projectsync.localproperties.OhosPostSyncExtension"
                  topic="com.android.tools.idea.gradle.project.sync.GradleSyncListenerWithRoot"/>
    </projectListeners>
    
    <!-- Application Listeners -->
    <applicationListeners>
        <!-- Global Run Configuration Listener -->
        <listener class="org.jetbrains.plugins.template.device.GlobalRunConfigurationListener"
                  topic="com.intellij.execution.RunManagerListener"/>
    </applicationListeners>

</idea-plugin>
